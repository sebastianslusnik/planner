<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pilates Admin</title>
<link rel="preconnect" href="https://api.jsonbin.io">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#0b0f14;--card:#121821;--muted:#8aa0b2;--text:#e9f0f6;--acc:#7be0b8;--acc2:#ff6b6b;--ring:rgba(123,224,184,.45)}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#0b0f14,#0b1118);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
.container{max-width:1100px;margin:0 auto;padding:16px}
.card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.nav{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;margin-top:16px}
.tag{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-size:12px}
h2{margin:0 0 10px;font-size:22px}
.grid{display:grid;gap:12px}
.cols-2{grid-template-columns:1fr 1fr}
.cols-3{grid-template-columns:1fr 1fr 1fr}
.section{padding:20px 0}
.row{display:flex;gap:8px;flex-wrap:wrap}
.btn{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));color:var(--text);cursor:pointer}
.btn.primary{background:linear-gradient(180deg,rgba(123,224,184,.25),rgba(123,224,184,.12));border-color:rgba(123,224,184,.5)}
.btn.danger{background:linear-gradient(180deg,rgba(255,107,107,.22),rgba(255,107,107,.08));border-color:rgba(255,107,107,.5)}
.input{display:grid;gap:6px}
.input input,.input select,.input textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text);outline:none}
.input input:focus,.input select:focus,.input textarea:focus{border-color:var(--acc);box-shadow:0 0 0 4px var(--ring)}
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th,.table td{padding:10px 12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
.table th:first-child,.table td:first-child{border-radius:12px 0 0 12px}
.table th:last-child,.table td:last-child{border-radius:0 12px 12px 0}
.small{font-size:12px;color:var(--muted)}
.toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:#0d131a;border:1px solid rgba(255,255,255,.12);padding:12px 14px;border-radius:12px;display:none}
</style>
</head>
<body>
<div class="container">
  <div class="card nav">
    <div class="row">
      <div class="tag">Admin felület</div>
      <a class="tag" href="index.html">Vissza a weboldalra</a>
    </div>
    <div class="small">JSONBin kezelő</div>
  </div>

  <div class="section">
    <div class="grid cols-3">
      <div class="card" style="padding:14px;">
        <h2>Bejelentések</h2>
        <form id="annForm" class="grid">
          <div class="input"><label>Cím</label><input id="annTitle" type="text"></div>
          <div class="input"><label>Típus</label><select id="annType"><option value="info">Info</option><option value="success">Success</option><option value="danger">Danger</option></select></div>
          <div class="input"><label>Leírás</label><textarea id="annContent" rows="3"></textarea></div>
          <div class="input"><label>Lejárat</label><input id="annExp" type="date"></div>
          <div class="row"><button type="submit" class="btn primary">Hozzáadás</button></div>
        </form>
        <table class="table" style="margin-top:12px;">
          <thead><tr><th>Cím</th><th>Típus</th><th>Lejár</th><th>Aktív</th><th>Művelet</th></tr></thead>
          <tbody id="annTbl"></tbody>
        </table>
      </div>

      <div class="card" style="padding:14px;">
        <h2>Hírek</h2>
        <form id="newsForm" class="grid">
          <div class="input"><label>Cím</label><input id="newsTitle" type="text"></div>
          <div class="input"><label>Dátum</label><input id="newsDate" type="date"></div>
          <div class="input"><label>Tartalom</label><textarea id="newsContent" rows="3"></textarea></div>
          <div class="row"><button type="submit" class="btn primary">Hozzáadás</button></div>
        </form>
        <table class="table" style="margin-top:12px;">
          <thead><tr><th>Cím</th><th>Dátum</th><th>Művelet</th></tr></thead>
          <tbody id="newsTbl"></tbody>
        </table>
      </div>

      <div class="card" style="padding:14px;">
        <h2>Foglalások</h2>
        <div class="small">Felvétel kézzel vagy törlés</div>
        <form id="resForm" class="grid">
          <div class="input"><label>Típus</label><select id="resType"></select></div>
          <div class="grid cols-2">
            <div class="input"><label>Dátum</label><input id="resDate" type="date"></div>
            <div class="input"><label>Idő</label><input id="resTime" type="time"></div>
          </div>
          <div class="grid cols-2">
            <div class="input"><label>Név</label><input id="resName" type="text"></div>
            <div class="input"><label>E-mail</label><input id="resEmail" type="email"></div>
          </div>
          <div class="input"><label>Telefon</label><input id="resPhone" type="tel"></div>
          <div class="input"><label>Megjegyzés</label><input id="resNote" type="text"></div>
          <div class="row"><button type="submit" class="btn primary">Hozzáadás</button></div>
        </form>
        <table class="table" style="margin-top:12px;">
          <thead><tr><th>Dátum</th><th>Idő</th><th>Típus</th><th>Név</th><th>Művelet</th></tr></thead>
          <tbody id="resTbl"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="card" style="padding:14px;">
      <h2>Óratípusok és ismétlődő beosztás</h2>
      <div class="grid cols-2">
        <div>
          <div class="row" style="justify-content:space-between;align-items:center;"><div class="tag">Edzéstípusok</div><button id="addTypeBtn" class="btn">Új típus</button></div>
          <table class="table" style="margin-top:8px;">
            <thead><tr><th>Név</th><th>Szint</th><th>Férőhely</th><th>Szín</th><th>Művelet</th></tr></thead>
            <tbody id="typeTbl"></tbody>
          </table>
        </div>
        <div>
          <div class="row" style="justify-content:space-between;align-items:center;"><div class="tag">Ismétlődések</div><button id="addRecBtn" class="btn">Új ismétlődés</button></div>
          <table class="table" style="margin-top:8px;">
            <thead><tr><th>Nap</th><th>Idő</th><th>Típus</th><th>Művelet</th></tr></thead>
            <tbody id="recTbl"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const JSONBIN_KEY="$2a$10$9sO/ja29sMebpWNvsWmp5.dJ6lv7CPeLBMRFaA/cAEwz42ii6qlCS";
const BIN_ANN="68b5536243b1c97be932d1ed";
const BIN_RES="68b5535343b1c97be932d1e1";
const BIN_NEWS="68b5531fd0ea881f406dbd52";
const BIN_CAL="68b55123d0ea881f406dbb52";

const api={get:async(id)=>{const r=await fetch("https://api.jsonbin.io/v3/b/"+id,{headers:{"X-Master-Key":JSONBIN_KEY}});if(!r.ok)throw new Error("Hiba letöltéskor");const j=await r.json();return j.record},put:async(id,data)=>{const r=await fetch("https://api.jsonbin.io/v3/b/"+id,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key":JSONBIN_KEY},body:JSON.stringify(data)});if(!r.ok)throw new Error("Hiba mentéskor");return r.json()}};
const toast=(m)=>{const t=document.querySelector("#toast");t.textContent=m;t.style.display="block";setTimeout(()=>t.style.display="none",2200)};

const state={ann:[],news:[],res:[],cal:{trainingTypes:[],recurring:[]}};

async function loadAll(){
  const [ann,news,res,cal]=await Promise.all([api.get(BIN_ANN),api.get(BIN_NEWS),api.get(BIN_RES),api.get(BIN_CAL)]);
  state.ann=ann;state.news=news;state.res=res;state.cal=cal;
  renderAnn();renderNews();renderTypes();renderRecurring();renderRes();fillTypeSelects();
}

function renderAnn(){
  const tbody=document.querySelector("#annTbl");tbody.innerHTML="";
  state.ann.sort((a,b)=>((b.active?1:0)- (a.active?1:0))||String(b.expiresAt||"").localeCompare(String(a.expiresAt||""))).forEach(a=>{
    const tr=document.createElement("tr");
    tr.innerHTML='<td>'+a.title+'</td><td>'+a.type+'</td><td>'+(a.expiresAt||"")+'</td><td>'+(a.active!==false?"Igen":"Nem")+'</td><td><div class="row"><button class="btn" data-act="toggle">Aktív vált</button><button class="btn" data-act="del">Törlés</button></div></td>';
    tr.querySelector('[data-act="toggle"]').onclick=()=>{a.active=a.active===false?true:false;saveAnn();};
    tr.querySelector('[data-act="del"]').onclick=()=>{state.ann=state.ann.filter(x=>x.id!==a.id);saveAnn();};
    tbody.appendChild(tr);
  });
}

function renderNews(){
  const tbody=document.querySelector("#newsTbl");tbody.innerHTML="";
  state.news.sort((a,b)=>b.date.localeCompare(a.date)).forEach(n=>{
    const tr=document.createElement("tr");
    tr.innerHTML='<td>'+n.title+'</td><td>'+n.date+'</td><td><div class="row"><button class="btn" data-act="edit">Szerk.</button><button class="btn" data-act="del">Törlés</button></div></td>';
    tr.querySelector('[data-act="del"]').onclick=()=>{state.news=state.news.filter(x=>x.id!==n.id);saveNews();};
    tr.querySelector('[data-act="edit"]').onclick=()=>{document.querySelector("#newsTitle").value=n.title;document.querySelector("#newsDate").value=n.date;document.querySelector("#newsContent").value=n.content;editing.news=n.id;};
    tbody.appendChild(tr);
  });
}

function renderTypes(){
  const tbody=document.querySelector("#typeTbl");tbody.innerHTML="";
  state.cal.trainingTypes.forEach(t=>{
    const tr=document.createElement("tr");
    tr.innerHTML='<td>'+t.name+'</td><td>'+t.level+'</td><td>'+t.capacity+'</td><td><span class="tag" style="background:'+t.color+'">'+t.color+'</span></td><td><div class="row"><button class="btn" data-act="edit">Szerk.</button><button class="btn" data-act="del">Törlés</button></div></td>';
    tr.querySelector('[data-act="del"]').onclick=()=>{state.cal.trainingTypes=state.cal.trainingTypes.filter(x=>x.id!==t.id);state.cal.recurring=state.cal.recurring.filter(r=>r.trainingTypeId!==t.id);saveCal();};
    tr.querySelector('[data-act="edit"]').onclick=()=>{openTypeEditor(t)};
    tbody.appendChild(tr);
  });
}

function renderRecurring(){
  const tbody=document.querySelector("#recTbl");tbody.innerHTML="";
  const name=(id)=>state.cal.trainingTypes.find(t=>t.id===id)?.name||"";
  const days=["V","H","K","Sze","Cs","P","Szo"];
  state.cal.recurring.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML='<td>'+days[r.weekday]+'</td><td>'+r.time+'</td><td>'+name(r.trainingTypeId)+'</td><td><div class="row"><button class="btn" data-act="edit">Szerk.</button><button class="btn" data-act="del">Törlés</button></div></td>';
    tr.querySelector('[data-act="del"]').onclick=()=>{state.cal.recurring=state.cal.recurring.filter(x=>x.id!==r.id);saveCal();};
    tr.querySelector('[data-act="edit"]').onclick=()=>{openRecEditor(r)};
    tbody.appendChild(tr);
  });
}

function renderRes(){
  const tbody=document.querySelector("#resTbl");tbody.innerHTML="";
  const name=(id)=>state.cal.trainingTypes.find(t=>t.id===id)?.name||"";
  state.res.sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time)).forEach(x=>{
    const tr=document.createElement("tr");
    tr.innerHTML='<td>'+x.date+'</td><td>'+x.time+'</td><td>'+name(x.trainingTypeId)+'</td><td>'+x.name+'</td><td><div class="row"><button class="btn" data-act="del">Törlés</button></div></td>';
    tr.querySelector('[data-act="del"]').onclick=()=>{state.res=state.res.filter(r=>r.id!==x.id);saveRes();};
    tbody.appendChild(tr);
  });
}

async function saveAnn(){await api.put(BIN_ANN,state.ann);renderAnn();toast("Bejelentések mentve")}
async function saveNews(){await api.put(BIN_NEWS,state.news);renderNews();toast("Hírek mentve")}
async function saveCal(){await api.put(BIN_CAL,state.cal);renderTypes();renderRecurring();fillTypeSelects();toast("Órarend mentve")}
async function saveRes(){await api.put(BIN_RES,state.res);renderRes();toast("Foglalások mentve")}

const editing={news:null,type:null,rec:null};

document.querySelector("#annForm").addEventListener("submit",e=>{
  e.preventDefault();
  const title=document.querySelector("#annTitle").value.trim();
  const type=document.querySelector("#annType").value;
  const content=document.querySelector("#annContent").value.trim();
  const expiresAt=document.querySelector("#annExp").value||null;
  if(!title||!content){toast("Hiányzó adatok");return}
  state.ann=[...state.ann,{id:crypto.randomUUID?crypto.randomUUID():String(Date.now()),title,content,type,expiresAt,active:true}];
  document.querySelector("#annForm").reset();
  saveAnn();
});

document.querySelector("#newsForm").addEventListener("submit",e=>{
  e.preventDefault();
  const title=document.querySelector("#newsTitle").value.trim();
  const date=document.querySelector("#newsDate").value||new Date().toISOString().slice(0,10);
  const content=document.querySelector("#newsContent").value.trim();
  if(!title||!content){toast("Hiányzó adatok");return}
  if(editing.news){
    state.news=state.news.map(n=>n.id===editing.news?{...n,title,date,content}:n);
    editing.news=null;
  }else{
    state.news=[...state.news,{id:crypto.randomUUID?crypto.randomUUID():String(Date.now()),title,image:null,content,date}];
  }
  document.querySelector("#newsForm").reset();
  saveNews();
});

document.querySelector("#resForm").addEventListener("submit",e=>{
  e.preventDefault();
  const trainingTypeId=document.querySelector("#resType").value;
  const date=document.querySelector("#resDate").value;
  const time=document.querySelector("#resTime").value;
  const name=document.querySelector("#resName").value.trim();
  const email=document.querySelector("#resEmail").value.trim();
  const phone=document.querySelector("#resPhone").value.trim();
  const note=document.querySelector("#resNote").value.trim();
  if(!trainingTypeId||!date||!time||!name){toast("Hiányzó adatok");return}
  state.res=[...state.res,{id:crypto.randomUUID?crypto.randomUUID():String(Date.now()),trainingTypeId,date,time,name,email,phone,note,createdAt:new Date().toISOString()}];
  document.querySelector("#resForm").reset();
  saveRes();
});

function fillTypeSelects(){
  const sel=document.querySelector("#resType");sel.innerHTML="";
  state.cal.trainingTypes.forEach(t=>{const o=document.createElement("option");o.value=t.id;o.textContent=t.name;sel.appendChild(o)});
}

function openTypeEditor(t){
  editing.type=t.id;
  const name=prompt("Név:",t.name);if(name===null)return;
  const level=prompt("Szint:",t.level||"");if(level===null)return;
  const desc=prompt("Leírás:",t.description||"");if(desc===null)return;
  const loc=prompt("Helyszín:",t.location||"");if(loc===null)return;
  const color=prompt("Szín (#hex):",t.color||"#7be0b8");if(color===null)return;
  const cap=Number(prompt("Férőhely:",t.capacity||12)||t.capacity||12);
  const dur=Number(prompt("Időtartam perc:",t.duration||60)||t.duration||60);
  state.cal.trainingTypes=state.cal.trainingTypes.map(x=>x.id===t.id?{...x,name,level,description:desc,location:loc,color,capacity:cap,duration:dur}:x);
  saveCal();
}

document.querySelector("#addTypeBtn").onclick=()=>{
  const name=prompt("Név:");if(!name)return;
  const level=prompt("Szint:","Kezdő")||"";
  const desc=prompt("Leírás:","")||"";
  const loc=prompt("Helyszín:","Moson")||"";
  const color=prompt("Szín (#hex):","#3ee21d")||"#3ee21d";
  const cap=Number(prompt("Férőhely:","12")||12);
  const dur=Number(prompt("Időtartam perc:","60")||60);
  state.cal.trainingTypes=[...state.cal.trainingTypes,{id:crypto.randomUUID?crypto.randomUUID():String(Date.now()),name,level,description:desc,location:loc,color,capacity:cap,duration:dur}];
  saveCal();
};

function openRecEditor(r){
  const day=Number(prompt("Hét napja (0=V,1=H,...,6=Szo):",r.weekday));if(Number.isNaN(day))return;
  const time=prompt("Idő (HH:MM):",r.time)||r.time;
  const type=prompt("Típus ID:",r.trainingTypeId)||r.trainingTypeId;
  state.cal.recurring=state.cal.recurring.map(x=>x.id===r.id?{...x,weekday:day,time,trainingTypeId:type}:x);
  saveCal();
}

document.querySelector("#addRecBtn").onclick=()=>{
  const day=Number(prompt("Hét napja (0=V,1=H,...,6=Szo):","1"));if(Number.isNaN(day))return;
  const time=prompt("Idő (HH:MM):","18:00");if(!time)return;
  const list=state.cal.trainingTypes.map(t=>t.id+" • "+t.name).join("\n");
  const type=prompt("Típus ID az alábbi listából:\n"+list,state.cal.trainingTypes[0]?.id||"");if(!type)return;
  state.cal.recurring=[...state.cal.recurring,{id:crypto.randomUUID?crypto.randomUUID():String(Date.now()),trainingTypeId:type,weekday:day,time,location:null,capacity:null}];
  saveCal();
};

loadAll().catch(()=>toast("Hálózati hiba"));
</script>
</body>
</html>
