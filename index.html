<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="theme-color" content="#0b0d10">
<title>Világbajnok Kick-box Edző | Mosonmagyaróvár</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0b0d10;--bg2:#101319;--card:#141924;--muted:#8b93a7;--text:#e6ebf5;--accent:#e11d2e;--accent2:#d4af37;--ok:#22c55e;--warn:#f59e0b;--danger:#ef4444}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;line-height:1.5}
a{color:inherit;text-decoration:none}
img{max-width:100%;display:block}
.container{width:100%;max-width:1100px;margin:0 auto;padding:0 16px}
.section{padding:56px 0}
.section-head{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:20px}
.section h2{font-family:Oswald,Inter,sans-serif;letter-spacing:.5px;font-size:28px;margin:0 0 8px}
.section p.lead{color:var(--muted);margin:0 0 14px}
.btn{display:inline-flex;align-items:center;justify-content:center;border:none;background:var(--accent);color:#fff;padding:12px 16px;border-radius:10px;font-weight:700;letter-spacing:.3px;transition:.2s;cursor:pointer}
.btn:hover{transform:translateY(-1px);filter:brightness(1.07)}
.btn.alt{background:transparent;border:1px solid #2a3140}
.btn.ghost{background:#1a212f;border:1px solid #283144}
.badge{display:inline-block;padding:2px 10px;border-radius:999px;font-size:12px;font-weight:700;background:rgba(226,29,46,.12);color:var(--accent);border:1px solid rgba(226,29,46,.25)}
.header{position:sticky;top:0;z-index:80;background:linear-gradient(180deg,rgba(11,13,16,.9),rgba(11,13,16,.6) 60%,transparent);backdrop-filter:saturate(120%) blur(10px)}
.topbar{width:100%;overflow:auto;white-space:nowrap;background:linear-gradient(90deg,#141924,#0b0d10);border-bottom:1px solid #1d2331}
.ann-strip{display:flex;gap:12px;padding:8px 12px;align-items:center}
.ann-pill{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid #2b3242;background:#121724;color:#dfe6f5}
.ann-pill.warn{border-color:rgba(245,158,11,.35);background:rgba(245,158,11,.08);color:#ffd386}
.ann-pill.danger{border-color:rgba(239,68,68,.35);background:rgba(239,68,68,.08);color:#ffc1c1}
.nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.brand{display:flex;align-items:center;gap:12px}
.brand .logo{height:38px;width:38px;border-radius:10px;display:grid;place-items:center;background:radial-gradient(120px 120px at 30% 20%,#2b3245 0%,#151a24 65%,#0b0d10 100%);box-shadow:inset 0 0 0 1px #2a3043,0 12px 30px rgba(0,0,0,.35)}
.brand .logo span{font-family:Oswald,sans-serif;font-weight:700;color:var(--accent2);font-size:18px}
.brand .name{font-family:Oswald,sans-serif;font-size:18px;letter-spacing:.8px}
.navlinks{display:none;gap:14px}
.navlinks a{padding:8px 10px;border-radius:8px;color:#d2d8e5}
.burger{display:inline-flex;background:#151a22;border:1px solid #272e3f;padding:8px;border-radius:10px}
#mobileMenu{display:none;position:absolute;left:0;right:0;top:100%;background:#0d1016;border-bottom:1px solid #1b2231;padding:12px}
#mobileMenu a{display:block;padding:10px 12px;border-radius:8px;color:#e1e7f5}
.hero{padding:32px 0 24px;background:radial-gradient(800px 400px at 10% 0%,rgba(225,29,46,.18),transparent 60%),radial-gradient(700px 350px at 95% 10%,rgba(212,175,55,.14),transparent 60%)}
.hero-wrap{display:grid;grid-template-columns:1fr;gap:18px}
.h-title{font-family:Oswald,Inter,sans-serif;font-weight:700;font-size:34px;letter-spacing:.6px;margin:8px 0}
.h-sub{color:var(--muted)}
.hero-cta{display:flex;gap:10px;flex-wrap:wrap}
.hero-card{border:1px solid #202738;background:linear-gradient(180deg,#0f131a,#0b0d10);border-radius:16px;padding:16px;display:flex;gap:14px;align-items:center}
.hero-card img{width:72px;height:72px;border-radius:12px;object-fit:cover;border:1px solid #2a3244}
.info-grid{display:grid;grid-template-columns:1fr;gap:16px}
.info-card{background:linear-gradient(180deg,#0f131a,#0b0d10);border:1px solid #20283a;border-radius:16px;padding:16px}
.pricing-grid{display:grid;grid-template-columns:1fr;gap:14px}
.price-card{border:1px solid #232a3d;background:linear-gradient(180deg,#0e131b,#0b0d10);border-radius:16px;padding:16px;display:flex;flex-direction:column;gap:12px}
.price{font-family:Oswald,sans-serif;font-size:28px}
.gallery-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.gallery-grid img{border-radius:10px;height:90px;object-fit:cover}
.gallery-grid button{border:none;padding:0;background:transparent}
.news-grid{display:grid;grid-template-columns:1fr;gap:14px}
.news-card{display:flex;gap:12px;border:1px solid #232a3c;background:#0f131a;border-radius:16px;overflow:hidden}
.news-card img{width:120px;height:120px;object-fit:cover}
.news-body{padding:12px}
.calendar-wrap{border:1px solid #232a3d;border-radius:16px;background:linear-gradient(180deg,#0f131a,#0b0d10)}
.calendar-head{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #1f2635}
.calendar-head .when{display:flex;gap:8px;align-items:center}
.calendar-head .when strong{font-family:Oswald,sans-serif;letter-spacing:.4px}
.calendar-body{padding:10px}
.session{display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid #232a3d;background:#0e131b;border-radius:12px;padding:10px;margin-bottom:8px}
.s-left{display:flex;gap:10px;align-items:center}
.color{width:14px;height:14px;border-radius:4px;box-shadow:0 0 0 2px rgba(255,255,255,.06) inset}
.s-name{font-weight:700}
.s-sub{color:var(--muted);font-size:12px}
.s-cap{font-size:12px;color:#b9c2d6}
.tabs{display:flex;gap:8px}
.tab{padding:6px 10px;border-radius:999px;border:1px solid #263049;background:#0e131b;color:#d7dff0;cursor:pointer}
.tab.active{background:var(--accent);border-color:transparent}
.modal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;z-index:100}
.modal.active{display:flex}
.modal .sheet{background:#0d1118;border-top-left-radius:16px;border-top-right-radius:16px;width:100%;max-width:560px;border:1px solid #1d2434;padding:16px}
.form{display:grid;gap:10px}
.input{display:grid;gap:6px}
.input input,.input select,.input textarea{width:100%;padding:12px;background:#0b0f16;border:1px solid #283045;border-radius:10px;color:#f0f5ff}
.input small{color:var(--muted)}
.form .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#0e131b;border:1px solid #273049;color:#e9efff;padding:10px 14px;border-radius:10px;display:none;z-index:120}
.about{display:grid;grid-template-columns:1fr;gap:14px}
.about-card{display:flex;gap:14px;align-items:center;border:1px solid #232a3c;background:#0f131a;border-radius:16px;padding:14px}
.contact{display:grid;grid-template-columns:1fr;gap:14px}
.map{width:100%;height:260px;border:1px solid #222b3f;border-radius:16px;overflow:hidden}
.footer{padding:28px 0;border-top:1px solid #1b2231;background:#0a0d12}
.footer .cols{display:grid;grid-template-columns:1fr;gap:16px}
.ref{color:#aeb7ca}
.month-head{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-bottom:6px}
.month-head div{font-size:12px;color:#a9b2c7;text-align:center}
.month-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.day{border:1px solid #222b36;background:#0d121a;border-radius:10px;padding:8px;min-height:84px;display:flex;flex-direction:column}
.day.muted{opacity:.6}
.day .num{font-weight:700;margin-bottom:6px;color:#dfe6f7;font-size:12px}
.slot{display:flex;align-items:center;justify-content:space-between;gap:8px;border:1px solid #232a3d;background:#0f141d;border-radius:8px;padding:6px;margin-bottom:6px}
.slot .left{display:flex;align-items:center;gap:8px}
.slot .dot{width:10px;height:10px;border-radius:3px}
.slot .txt{font-size:12px}
@media(min-width:740px){
.navlinks{display:flex}
.burger{display:none}
.hero-wrap{grid-template-columns:1.1fr .9fr;align-items:center}
.info-grid{grid-template-columns:repeat(3,1fr)}
.pricing-grid{grid-template-columns:repeat(4,1fr)}
.gallery-grid{grid-template-columns:repeat(6,1fr)}
.news-grid{grid-template-columns:repeat(2,1fr)}
.about{grid-template-columns:1.1fr .9fr}
.contact{grid-template-columns:1fr 1fr}
.day{min-height:120px}
}
</style>
</head>
<body>
<header class="header">
<div class="topbar">
<div class="ann-strip container" id="annStrip"></div>
</div>
<div class="container nav">
<div class="brand">
<div class="logo"><span>KB</span></div>
<div class="name">Világbajnok Kick-box Edző</div>
</div>
<nav class="navlinks">
<a href="#rolam">Rólam</a>
<a href="#kickbox">Mi az a kick-box?</a>
<a href="#arak">Árak</a>
<a href="#naptar">Edzésnaptár</a>
<a href="#hirek">Hírek</a>
<a href="#galeria">Galéria</a>
<a href="#kapcsolat">Kapcsolat</a>
</nav>
<button class="burger" id="burger" aria-label="Menü"><svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="#aeb7ca" stroke-width="2" stroke-linecap="round"/></svg></button>
</div>
<div id="mobileMenu" class="container">
<a href="#rolam">Rólam</a>
<a href="#kickbox">Mi az a kick-box?</a>
<a href="#arak">Árak</a>
<a href="#naptar">Edzésnaptár</a>
<a href="#hirek">Hírek</a>
<a href="#galeria">Galéria</a>
<a href="#kapcsolat">Kapcsolat</a>
</div>
</header>

<section class="hero">
<div class="container hero-wrap">
<div>
<span class="badge">Mosonmagyaróvár</span>
<h1 class="h-title">Kick-box edzések világbajnok szinten</h1>
<p class="h-sub">Modern, erőteljes, férfias stílus. Technikák, erőnlét, fegyelem és mentális fókusz. Csatlakozz a közösséghez és eddz célirányosan, okosan.</p>
<div class="hero-cta">
<a class="btn" href="#naptar">Időpont foglalása</a>
<a class="btn alt" href="#arak">Árak és csomagok</a>
</div>
</div>
<div class="hero-card">
<img src="https://images.unsplash.com/photo-1517438322307-e67111335449?q=80&w=600&auto=format&fit=crop" alt="Kick-box">
<div>
<div class="s-name">Kiemelt edzés</div>
<div class="s-sub">Haladó kombinációk, erő-állóképesség, sparring fókusz</div>
</div>
</div>
</div>
</section>

<section id="kickbox" class="section">
<div class="container">
<div class="section-head">
<h2>Mi az a kick-box?</h2>
</div>
<div class="info-grid">
<div class="info-card"><strong>Átfogó harcművészet</strong><p>A kick-box ütések és rúgások kombinációjára épülő, dinamikus küzdősport. Fejleszti a robbanékonyságot, reakcióidőt, testtudatot.</p></div>
<div class="info-card"><strong>Fizikum és technika</strong><p>Az edzéseken technikai kombinációk, lépéstechnikák, zsákmunka, erősítő és mobilitási blokkok váltják egymást.</p></div>
<div class="info-card"><strong>Biztonságos fejlődés</strong><p>Fokozatos felépítés, partner- és zsákgyakorlatok. A sparring irányított, kontrollált környezetben történik.</p></div>
</div>
</div>
</section>

<section id="arak" class="section">
<div class="container">
<div class="section-head">
<h2>Árak és csomagok</h2>
</div>
<div class="pricing-grid">
<div class="price-card">
<div class="price">3 500 Ft</div>
<div>Alkalmi belépő</div>
<ul>
<li>1 edzés</li>
<li>Kezdőknek és haladóknak</li>
</ul>
<button class="btn" onclick="scrollToCalendar()">Foglalok</button>
</div>
<div class="price-card">
<div class="price">28 000 Ft</div>
<div>10 alkalmas bérlet</div>
<ul>
<li>60 napig érvényes</li>
<li>Kedvezményes egységár</li>
</ul>
<button class="btn" onclick="scrollToCalendar()">Foglalok</button>
</div>
<div class="price-card">
<div class="price">24 900 Ft</div>
<div>Havi korlátlan</div>
<ul>
<li>Korlátlan csoportos</li>
<li>Havi megújulás</li>
</ul>
<button class="btn" onclick="scrollToCalendar()">Foglalok</button>
</div>
<div class="price-card">
<div class="price">8 900 Ft</div>
<div>Személyi edzés</div>
<ul>
<li>1x60 perc</li>
<li>Egyéni célokhoz igazítva</li>
</ul>
<a class="btn" href="#kapcsolat">Időpont egyeztetés</a>
</div>
</div>
</div>
</section>

<section id="naptar" class="section">
<div class="container">
<div class="section-head">
<h2>Edzésnaptár</h2>
<p class="lead">Válassz időpontot és foglalj helyet. Az edzések létszáma korlátozott.</p>
</div>
<div class="calendar-wrap">
<div class="calendar-head">
<div class="when"><button class="tab" id="prevPeriod" aria-label="Előző">‹</button><strong id="periodLabel">–</strong><button class="tab" id="nextPeriod" aria-label="Következő">›</button></div>
<div class="tabs">
<button class="tab active" id="tabList">Lista</button>
<button class="tab" id="tabMonth">Havi</button>
</div>
</div>
<div class="calendar-body">
<div id="sessionsList"></div>
<div id="sessionsMonth" style="display:none"></div>
</div>
</div>
</div>
</section>

<section id="galeria" class="section">
<div class="container">
<div class="section-head"><h2>Galéria</h2></div>
<div class="gallery-grid" id="gallery">
<button><img src="https://images.unsplash.com/photo-1607962837359-915385c5a8f3?q=80&w=600&auto=format&fit=crop" alt=""></button>
<button><img src="https://images.unsplash.com/photo-1521805103424-d8f8430e8930?q=80&w=600&auto=format&fit=crop" alt=""></button>
<button><img src="https://images.unsplash.com/photo-1605296867304-46d5465a13f1?q=80&w=600&auto=format&fit=crop" alt=""></button>
<button><img src="https://images.unsplash.com/photo-1534158914592-062992fbe900?q=80&w=600&auto=format&fit=crop" alt=""></button>
<button><img src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=600&auto=format&fit=crop" alt=""></button>
<button><img src="https://images.unsplash.com/photo-1597466765990-64ad1c35dafc?q=80&w=600&auto=format&fit=crop" alt=""></button>
</div>
</div>
</section>

<section id="hirek" class="section">
<div class="container">
<div class="section-head">
<h2>Hírek</h2>
<p class="lead">Friss közlemények és beszámolók az edzőtől.</p>
</div>
<div class="news-grid" id="newsGrid"></div>
</div>
</section>

<section id="rolam" class="section">
<div class="container">
<div class="section-head">
<h2>Rólam</h2>
</div>
<div class="about">
<div class="about-card">
<img src="https://images.unsplash.com/photo-1549057446-9f5c6ac91a04?q=80&w=600&auto=format&fit=crop" alt="Edző" style="width:96px;height:96px;border-radius:12px;object-fit:cover;border:1px solid #2a3244">
<div>
<div class="s-name">Világbajnok Kick-box Edző</div>
<div class="s-sub">Nemzetközi verseny- és edzői tapasztalat, profi felkészítési rendszer. Kezdőtől a haladóig, minden szinten.</div>
</div>
</div>
<div class="info-card">
<strong>Filozófia</strong>
<p>Célorientált felkészítés, erős alaptechnikák, okos periodizáció. A fejlődés mérése, kontrollált terhelés és mentális fókusz minden edzés része.</p>
</div>
</div>
</div>
</section>

<section id="kapcsolat" class="section">
<div class="container">
<div class="section-head">
<h2>Kapcsolat</h2>
</div>
<div class="contact">
<div class="info-card">
<p><strong>Helyszín</strong><br>Mosonmagyaróvár, Magyarország</p>
<p><strong>E-mail</strong><br><a href="mailto:info@kickbox-movar.hu">info@kickbox-movar.hu</a></p>
<p><strong>Telefon</strong><br><a href="tel:+36301234567">+36 30 123 4567</a></p>
<p><a class="btn ghost" href="https://maps.google.com/?q=Mosonmagyar%C3%B3v%C3%A1r" target="_blank" rel="noopener">Útvonalterv</a></p>
</div>
<div class="map">
<iframe title="Térkép - Mosonmagyaróvár" src="https://www.google.com/maps?q=Mosonmagyar%C3%B3v%C3%A1r,Hungary&output=embed" width="100%" height="100%" frameborder="0" style="border:0"></iframe>
</div>
</div>
</div>
</section>

<footer class="footer">
<div class="container">
<div class="cols">
<div class="ref">© <span id="year"></span> Világbajnok Kick-box Edző • Mosonmagyaróvár</div>
<div class="ref">Közösség: <a href="#" aria-label="Instagram">Instagram</a> • <a href="#" aria-label="Facebook">Facebook</a></div>
<div class="ref">További hivatkozások: <a href="#hirek">Hírek</a> • <a href="#naptar">Naptár</a> • <a href="admin.html">Admin</a></div>
</div>
</div>
</footer>

<div class="modal" id="imgModal">
<div class="sheet" style="border-top-left-radius:16px;border-top-right-radius:16px">
<div style="display:flex;justify-content:flex-end">
<button class="btn alt" id="imgClose">Bezárás</button>
</div>
<img id="imgPreview" alt="" style="width:100%;height:auto;border-radius:10px;margin-top:8px">
</div>
</div>

<div class="modal" id="bookModal">
<div class="sheet">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
<div style="font-weight:700">Foglalás</div>
<button class="btn alt" id="bookClose">Bezárás</button>
</div>
<form class="form" id="bookForm">
<div class="input"><label>Választott edzés</label><input id="bfTraining" type="text" readonly></div>
<div class="row">
<div class="input"><label>Dátum</label><input id="bfDate" type="text" readonly></div>
<div class="input"><label>Időpont</label><input id="bfTime" type="text" readonly></div>
</div>
<div class="row">
<div class="input"><label>Teljes név</label><input id="bfName" type="text" required></div>
<div class="input"><label>E-mail</label><input id="bfEmail" type="email" required></div>
</div>
<div class="row">
<div class="input"><label>Telefon</label><input id="bfPhone" type="tel" required></div>
<div class="input"><label>Megjegyzés</label><input id="bfNote" type="text" placeholder="Opcionális"></div>
</div>
<input type="hidden" id="bfTrainingId">
<input type="hidden" id="bfCapacity">
<button class="btn" type="submit">Foglalás megerősítése</button>
<small class="s-sub">A foglalással elfogadod a részvételi feltételeket.</small>
</form>
</div>
</div>

<div class="toast" id="toast"></div>

<script>
const JSONBIN_KEY="$2a$10$9sO/ja29sMebpWNvsWmp5.dJ6lv7CPeLBMRFaA/cAEwz42ii6qlCS";
const BINS={ann:"68b5536243b1c97be932d1ed",res:"68b5535343b1c97be932d1e1",news:"68b5531fd0ea881f406dbd52",cal:"68b55123d0ea881f406dbb52"};
const huDaysFull=["Vasárnap","Hétfő","Kedd","Szerda","Csütörtök","Péntek","Szombat"];
const huDaysShort=["H","K","Sze","Cs","P","Szo","V"];
const huMonths=["január","február","március","április","május","június","július","augusztus","szeptember","október","november","december"];
const today=new Date();
let weekStart=startOfWeek(today);
let monthStart=startOfMonth(today);
let state={calendar:{trainingTypes:[],recurring:[]},reservations:[],announcements:[],news:[]};
function startOfWeek(d){const x=new Date(d);const wd=(x.getDay()+6)%7;x.setDate(x.getDate()-wd);x.setHours(0,0,0,0);return x}
function endOfWeek(d){const x=new Date(d);x.setDate(x.getDate()+6);x.setHours(23,59,59,999);return x}
function startOfMonth(d){const x=new Date(d.getFullYear(),d.getMonth(),1);x.setHours(0,0,0,0);return x}
function endOfMonth(d){return new Date(d.getFullYear(),d.getMonth()+1,0,23,59,59,999)}
function addMonths(d,n){const x=new Date(d);x.setMonth(x.getMonth()+n);x.setDate(1);x.setHours(0,0,0,0);return x}
function fmtDateISO(d){const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,"0");const da=String(d.getDate()).padStart(2,"0");return y+"-"+m+"-"+da}
function fmtHuman(d){return d.getDate()+". "+huMonths[d.getMonth()]+" "+d.getFullYear()+"."}
function fmtMonthLabel(d){return huMonths[d.getMonth()]+" "+d.getFullYear()+"."}
function h(ts){const d=new Date(ts);return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")}
function addDays(d,n){const x=new Date(d);x.setDate(x.getDate()+n);return x}
function uid(){if(crypto&&crypto.randomUUID){return crypto.randomUUID()}return "id-"+Date.now()+"-"+Math.floor(Math.random()*1e6)}
async function getBin(id){try{const r=await fetch("https://api.jsonbin.io/v3/b/"+id+"/latest",{headers:{"X-Master-Key":JSONBIN_KEY}});if(!r.ok)throw new Error("get "+id);const j=await r.json();return j.record}catch(e){return null}}
async function putBin(id,data){const r=await fetch("https://api.jsonbin.io/v3/b/"+id,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key":JSONBIN_KEY},body:JSON.stringify(data)});if(!r.ok)throw new Error("put "+id);return true}
function toast(msg){const t=document.getElementById("toast");t.textContent=msg;t.style.display="block";setTimeout(()=>{t.style.display="none"},2400)}
function sampleCalendar(){return {trainingTypes:[{id:"t1",name:"Alap technika",description:"Kezdőknek technikai alapok",level:"Kezdő",color:"#4f46e5",capacity:14,duration:60,location:"Dojo A"},{id:"t2",name:"Erő-állóképesség",description:"Kondicionáló fókusz",level:"Nyílt",color:"#22c55e",capacity:16,duration:60,location:"Dojo B"},{id:"t3",name:"Haladó kombinációk",description:"Kombinációk és sparring",level:"Haladó",color:"#e11d2e",capacity:12,duration:75,location:"Dojo A"}],recurring:[{id:"r1",trainingTypeId:"t1",weekday:1,time:"18:00",location:"Dojo A"},{id:"r2",trainingTypeId:"t2",weekday:3,time:"18:00",location:"Dojo B"},{id:"r3",trainingTypeId:"t3",weekday:5,time:"17:30",location:"Dojo A"}]}}
async function loadAll(){const [ann,cal,news,res]=await Promise.all([getBin(BINS.ann),getBin(BINS.cal),getBin(BINS.news),getBin(BINS.res)]);state.announcements=Array.isArray(ann)?ann:[];state.calendar=cal&&cal.trainingTypes?cal:sampleCalendar();state.news=Array.isArray(news)?news:[];state.reservations=Array.isArray(res)?res:[];renderAll()}
function renderAll(){renderAnnouncements();renderNews();renderCalendar();document.getElementById("year").textContent=String(new Date().getFullYear())}
function renderAnnouncements(){const wrap=document.getElementById("annStrip");wrap.innerHTML="";const now=new Date();const list=state.announcements.filter(a=>a.active!==false).filter(a=>!a.expiresAt||new Date(a.expiresAt)>=now);if(list.length===0){const n=document.createElement("div");n.className="ann-pill";n.innerHTML="<strong>Üdvözlünk!</strong>&nbsp; Nézd meg a legfrissebb időpontokat és foglalj.";wrap.appendChild(n);return}list.forEach(a=>{const el=document.createElement("div");el.className="ann-pill"+(a.type==="warning"?" warn":a.type==="danger"?" danger":"");el.innerHTML="<strong>"+a.title+"</strong> "+(a.content||"");wrap.appendChild(el)})}
function sessionsBetween(from,to){const out=[];const {trainingTypes,recurring}=state.calendar;for(let i=0;i<recurring.length;i++){const r=recurring[i];let cur=new Date(from);cur.setHours(0,0,0,0);while(cur<=to){if(cur.getDay()===r.weekday){const dstr=fmtDateISO(cur);out.push({id:"s-"+r.id+"-"+dstr,trainingTypeId:r.trainingTypeId,date:dstr,time:r.time,location:r.location||findType(r.trainingTypeId)?.location||"",capacityOverride:r.capacity});cur=addDays(cur,7)}else{cur=addDays(cur,1)}}}out.sort((a,b)=>new Date(a.date+"T"+a.time)-new Date(b.date+"T"+b.time));return out}
function occFor(session){return state.reservations.filter(x=>x.trainingTypeId===session.trainingTypeId&&x.date===session.date&&x.time===session.time).length}
function findType(id){return state.calendar.trainingTypes.find(t=>t.id===id)}
function renderCalendar(){renderCalendarList();renderCalendarMonth()}
function renderCalendarList(){const ws=weekStart;const we=endOfWeek(ws);document.getElementById("periodLabel").textContent=fmtHuman(ws)+" – "+fmtHuman(we);const list=sessionsBetween(ws,we);const listWrap=document.getElementById("sessionsList");listWrap.innerHTML="";if(list.length===0){listWrap.innerHTML='<div class="info-card">Nincs ütemezett edzés ezen a héten.</div>';return}list.forEach(s=>{const t=findType(s.trainingTypeId);const cap=s.capacityOverride||t.capacity;const occ=occFor(s);const free=Math.max(0,cap-occ);const row=document.createElement("div");row.className="session";row.innerHTML='<div class="s-left"><div class="color" style="background:'+t.color+'"></div><div><div class="s-name">'+t.name+' • '+s.time+'</div><div class="s-sub">'+huDaysFull[new Date(s.date).getDay()]+' • '+s.date+' • '+(s.location||t.location)+' • '+t.level+'</div></div></div><div><div class="s-cap">'+occ+'/'+cap+' foglalt</div>'+(free>0?'<button class="btn" data-sid="'+s.id+'">Foglalás</button>':'<span class="badge">Betelt</span>')+'</div>';listWrap.appendChild(row)});document.querySelectorAll('button[data-sid]').forEach(b=>b.addEventListener('click',onBookClick))}
function renderCalendarMonth(){const ms=monthStart;const label=fmtMonthLabel(ms);const monthWrap=document.getElementById("sessionsMonth");const first=startOfMonth(ms);const last=endOfMonth(ms);const offset=(first.getDay()+6)%7;const gridStart=addDays(first,-offset);const daysCount=42;const gridEnd=addDays(gridStart,daysCount-1);if(document.getElementById("tabMonth").classList.contains("active")){document.getElementById("periodLabel").textContent=label}const sessions=sessionsBetween(gridStart,gridEnd);const byDate=new Map();sessions.forEach(s=>{const arr=byDate.get(s.date)||[];arr.push(s);byDate.set(s.date,arr)});monthWrap.innerHTML="";const head=document.createElement("div");head.className="month-head";huDaysShort.forEach(n=>{const d=document.createElement("div");d.textContent=n;head.appendChild(d)});monthWrap.appendChild(head);const grid=document.createElement("div");grid.className="month-grid";for(let i=0;i<42;i++){const d=addDays(gridStart,i);const dstr=fmtDateISO(d);const inMonth=d.getMonth()===ms.getMonth();const cell=document.createElement("div");cell.className="day"+(inMonth?"":" muted");cell.innerHTML='<div class="num">'+d.getDate()+".</div>";const arr=byDate.get(dstr)||[];arr.forEach(s=>{const t=findType(s.trainingTypeId);const cap=s.capacityOverride||t.capacity;const occ=occFor(s);const free=Math.max(0,cap-occ);const slot=document.createElement("div");slot.className="slot";slot.innerHTML='<div class="left"><div class="dot" style="background:'+t.color+'"></div><div class="txt">'+s.time+' • '+t.name+'</div></div>'+(free>0?'<button class="btn" style="padding:6px 8px;font-size:12px" data-sid="'+s.id+'">Foglal</button>':'<span class="badge">Betelt</span>');cell.appendChild(slot)});grid.appendChild(cell)}monthWrap.appendChild(grid);monthWrap.querySelectorAll('button[data-sid]').forEach(b=>b.addEventListener('click',onBookClick))}
function onBookClick(e){const sid=e.currentTarget.getAttribute("data-sid");const ws=weekStart;const we=endOfWeek(ws);const sessions=sessionsBetween(addDays(ws,-60),addDays(we,120));const s=sessions.find(x=>x.id===sid);if(!s)return;const t=findType(s.trainingTypeId);document.getElementById("bfTraining").value=t.name+" • "+t.level;document.getElementById("bfTrainingId").value=t.id;document.getElementById("bfDate").value=s.date;document.getElementById("bfTime").value=s.time;document.getElementById("bfCapacity").value=String(s.capacityOverride||t.capacity);document.getElementById("bookModal").classList.add("active")}
async function submitBooking(ev){ev.preventDefault();const trainingTypeId=document.getElementById("bfTrainingId").value;const date=document.getElementById("bfDate").value;const time=document.getElementById("bfTime").value;const name=document.getElementById("bfName").value.trim();const email=document.getElementById("bfEmail").value.trim();const phone=document.getElementById("bfPhone").value.trim();const note=document.getElementById("bfNote").value.trim();if(!name||!email||!phone){toast("Kérjük tölts ki a kötelező mezőket.");return}const latest=await getBin(BINS.res);state.reservations=Array.isArray(latest)?latest:[];const t=findType(trainingTypeId);const cap=Number(document.getElementById("bfCapacity").value||t.capacity);const occ=occFor({trainingTypeId,date,time});if(occ>=cap){toast("Sajnáljuk, ez az időpont betelt.");return}const rec={id:uid(),trainingTypeId,date,time,name,email,phone,note,createdAt:new Date().toISOString()};const newArr=[...state.reservations,rec];await putBin(BINS.res,newArr);state.reservations=newArr;toast("Foglalás rögzítve.");document.getElementById("bookModal").classList.remove("active");renderCalendar()}
function renderNews(){const grid=document.getElementById("newsGrid");grid.innerHTML="";if(state.news.length===0){grid.innerHTML='<div class="info-card">Még nincs közzétett hír.</div>';return}state.news.sort((a,b)=>new Date(b.date)-new Date(a.date));state.news.forEach(n=>{const card=document.createElement("div");card.className="news-card";const img=n.image||"https://images.unsplash.com/photo-1517438322307-e67111335449?q=80&w=600&auto=format&fit=crop";card.innerHTML='<img src="'+img+'" alt=""><div class="news-body"><div style="font-weight:700;margin-bottom:6px">'+n.title+'</div><div class="s-sub" style="margin-bottom:8px">'+new Date(n.date||Date.now()).toLocaleDateString("hu-HU")+'</div><div>'+n.content+'</div></div>';grid.appendChild(card)})}
function scrollToCalendar(){document.querySelector("#naptar").scrollIntoView({behavior:"smooth"})}
document.getElementById("prevPeriod").addEventListener("click",()=>{if(document.getElementById("tabMonth").classList.contains("active")){monthStart=addMonths(monthStart,-1);renderCalendarMonth()}else{weekStart=addDays(weekStart,-7);renderCalendarList()}});
document.getElementById("nextPeriod").addEventListener("click",()=>{if(document.getElementById("tabMonth").classList.contains("active")){monthStart=addMonths(monthStart,1);renderCalendarMonth()}else{weekStart=addDays(weekStart,7);renderCalendarList()}});
document.getElementById("tabList").addEventListener("click",()=>{document.getElementById("tabList").classList.add("active");document.getElementById("tabMonth").classList.remove("active");document.getElementById("sessionsList").style.display="block";document.getElementById("sessionsMonth").style.display="none";renderCalendarList()});
document.getElementById("tabMonth").addEventListener("click",()=>{document.getElementById("tabMonth").classList.add("active");document.getElementById("tabList").classList.remove("active");document.getElementById("sessionsList").style.display="none";document.getElementById("sessionsMonth").style.display="block";renderCalendarMonth()});
document.getElementById("bookClose").addEventListener("click",()=>document.getElementById("bookModal").classList.remove("active"));
document.getElementById("imgClose").addEventListener("click",()=>document.getElementById("imgModal").classList.remove("active"));
document.getElementById("bookForm").addEventListener("submit",submitBooking);
document.getElementById("burger").addEventListener("click",()=>{const m=document.getElementById("mobileMenu");m.style.display=m.style.display==="block"?"none":"block"});
document.querySelectorAll("#mobileMenu a").forEach(a=>a.addEventListener("click",()=>{document.getElementById("mobileMenu").style.display="none"}));
document.getElementById("gallery").addEventListener("click",e=>{const img=e.target.closest("img");if(!img)return;document.getElementById("imgPreview").src=img.src;document.getElementById("imgModal").classList.add("active")});
loadAll();
</script>
</body>
</html>
