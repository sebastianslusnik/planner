<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NUTU Team | Időpontfoglalás és hírek</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0e13;
  --bg-2:#121725;
  --panel:#171d2f;
  --card:#0f1422;
  --accent:#66f0a9;
  --accent-2:#ff4d6d;
  --accent-3:#6da9ff;
  --text:#edf1ff;
  --muted:#a6b0c3;
  --line:#273048;
  --shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
  --radius:16px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:linear-gradient(180deg,#0a0d14,#0c1020 35%,#0b0e13);color:var(--text);font-family:Outfit,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:1200px;margin:0 auto;padding:0 20px}
.header{position:sticky;top:0;z-index:50;background:rgba(11,14,19,.62);backdrop-filter:blur(14px);border-bottom:1px solid rgba(255,255,255,.06)}
.nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:44px;height:44px;border-radius:12px;background:conic-gradient(from 210deg at 50% 50%,#66f0a9,#6da9ff,#ff4d6d,#66f0a9);position:relative;box-shadow:0 10px 30px rgba(102,240,169,.25)}
.logo::after{content:"";position:absolute;inset:3px;border-radius:10px;background:radial-gradient(120px 120px at 30% 30%,rgba(255,255,255,.18),transparent 50%),linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.5))}
.brand h1{font-size:20px;letter-spacing:.6px;margin:0;font-weight:800}
.brand small{display:block;color:var(--muted);margin-top:-2px;font-weight:400}
.actions{display:flex;align-items:center;gap:8px}
.button{appearance:none;border:0;padding:12px 16px;border-radius:14px;background:linear-gradient(180deg,#1b233a,#0e1526);color:var(--text);box-shadow:var(--shadow);cursor:pointer;font-weight:600;letter-spacing:.2px;transition:.2s}
.button:hover{transform:translateY(-1px);box-shadow:0 14px 34px rgba(0,0,0,.45)}
.button.accent{background:linear-gradient(180deg,#6af2b4,#47d895);color:#08130e}
.button.ghost{background:transparent;border:1px solid var(--line)}
.grid{display:grid;grid-template-columns:1.2fr .8fr;gap:20px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
.hero{padding:24px 0 8px}
.announce-strip{display:flex;gap:12px;align-items:flex-start;overflow:auto;padding:8px 0 2px}
.badge{padding:6px 10px;border-radius:10px;font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.6px;white-space:nowrap}
.badge.danger{background:linear-gradient(180deg,rgba(255,77,109,.18),rgba(255,77,109,.06));color:#ff8aa1;border:1px solid rgba(255,77,109,.35)}
.badge.info{background:linear-gradient(180deg,rgba(109,169,255,.18),rgba(109,169,255,.06));color:#a9c7ff;border:1px solid rgba(109,169,255,.35)}
.badge.success{background:linear-gradient(180deg,rgba(102,240,169,.18),rgba(102,240,169,.06));color:#b7ffd8;border:1px solid rgba(102,240,169,.35)}
.panel{background:linear-gradient(180deg,#0c1222,#0c1120);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
.panel-header{display:flex;align-items:center;justify-content:space-between;padding:18px 18px 10px}
.panel-title{font-size:18px;font-weight:700}
.panel-sub{color:var(--muted);font-size:14px}
.panel-body{padding:16px 18px 20px}
.card{background:linear-gradient(180deg,#0c1120,#0a0f1d);border:1px solid var(--line);border-radius:14px;padding:14px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.kv{display:grid;grid-template-columns:auto 1fr;gap:8px 14px;font-size:14px;color:var(--muted)}
.kv b{color:var(--text)}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{padding:8px 12px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg,#12192b,#0e1526);font-size:13px}
.legend{display:flex;gap:8px;flex-wrap:wrap}
.legend .leg{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;border:1px solid var(--line)}
.leg-dot{width:10px;height:10px;border-radius:50%}
.calendar{display:grid;gap:10px}
.calendar-controls{display:flex;justify-content:space-between;align-items:center;padding:8px 0 12px}
.calendar-controls .cal-btn{padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg,#12192b,#0e1526);cursor:pointer}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.day{background:linear-gradient(180deg,#0b1120,#0a0f1e);border:1px solid var(--line);border-radius:12px;min-height:120px;padding:10px;display:flex;flex-direction:column;gap:8px}
.day.today{outline:2px solid rgba(102,240,169,.45)}
.day .dhead{display:flex;justify-content:space-between;color:var(--muted);font-size:12px}
.slot{display:flex;align-items:center;gap:8px;padding:8px;border-radius:10px;border:1px dashed rgba(255,255,255,.08);background:linear-gradient(180deg,#0d1426,#0c1222)}
.slot .dot{width:8px;height:8px;border-radius:50%}
.slot .meta{font-size:12px;color:var(--muted)}
.slot strong{display:block;font-size:13px}
.slot .book{margin-left:auto;padding:6px 10px;border-radius:10px;border:1px solid var(--line);background:linear-gradient(180deg,#131a2d,#0f1628);font-size:12px;cursor:pointer}
.slot.full{opacity:.5;filter:grayscale(.1)}
.hr{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);margin:12px 0}
.news-list{display:grid;gap:12px}
.news-item{display:flex;gap:12px;align-items:flex-start;border:1px solid var(--line);border-radius:14px;background:linear-gradient(180deg,#0c1120,#0a0f1d);padding:12px}
.news-item img{width:80px;height:80px;object-fit:cover;border-radius:10px;border:1px solid var(--line)}
.footer{margin-top:24px;padding:24px 0;color:var(--muted);border-top:1px solid var(--line);background:linear-gradient(180deg,#0a0e17,#0a0d14)}
.contact{display:grid;gap:8px}
.ann{display:flex;gap:10px;align-items:flex-start;border:1px solid var(--line);background:linear-gradient(180deg,#141a2b,#0f1526);padding:10px 12px;border-radius:12px}
.ann .type{font-size:11px;text-transform:uppercase;letter-spacing:.7px;border:1px solid var(--line);padding:4px 8px;border-radius:8px}
.modal{position:fixed;inset:0;background:rgba(7,9,13,.6);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;padding:20px;z-index:100}
.modal.active{display:flex}
.modal .sheet{width:100%;max-width:520px;background:linear-gradient(180deg,#0c1222,#0b1120);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow)}
.sheet .hd{padding:16px 16px 8px;display:flex;justify-content:space-between;align-items:center}
.sheet .bd{padding:16px}
.input{display:grid;gap:6px;margin-bottom:12px}
.input label{font-size:13px;color:var(--muted)}
.input input,.input select,.input textarea{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(180deg,#0f1628,#0d1426);color:var(--text);outline:none}
.input textarea{min-height:88px;resize:vertical}
.two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:520px){.two{grid-template-columns:1fr}}
.toast{position:fixed;right:16px;bottom:16px;background:linear-gradient(180deg,#0f172a,#0b1224);border:1px solid var(--line);color:var(--text);padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);display:none;z-index:200}
.toast.show{display:block}
</style>
</head>
<body>
<header class="header">
  <div class="container nav">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>NUTU Team</h1>
        <small>Farkas László NUTU – Kickbox világbajnok és személyi edző</small>
      </div>
    </div>
    <div class="actions">
      <a class="button ghost" href="#calendar">Időpontfoglalás</a>
      <a class="button accent" href="admin.html">Belépés az Adminba</a>
    </div>
  </div>
</header>

<section class="hero container">
  <div class="announce-strip" id="announceStrip"></div>
</section>

<main class="container grid" id="calendar">
  <section class="panel">
    <div class="panel-header">
      <div>
        <div class="panel-title">Edzés naptár és foglalás</div>
        <div class="panel-sub">Válassz időpontot és foglalj azonnal</div>
      </div>
      <div class="legend" id="legend"></div>
    </div>
    <div class="panel-body">
      <div class="calendar">
        <div class="calendar-controls">
          <button class="cal-btn" id="prevBtn">Előző hét</button>
          <div style="font-weight:700" id="calRange"></div>
          <button class="cal-btn" id="nextBtn">Következő hét</button>
        </div>
        <div class="calendar-grid" id="calGrid"></div>
      </div>
    </div>
  </section>

  <aside class="panel">
    <div class="panel-header">
      <div class="panel-title">Információk</div>
      <div class="panel-sub">Edzések, helyszín, kapcsolat</div>
    </div>
    <div class="panel-body">
      <div class="card">
        <div class="row">
          <div class="kv">
            <b>Helyszín</b><span>Jókai Mór utca 8., Mosonmagyaróvár</span>
            <b>Telefon</b><span><a href="tel:+36709493977">+36 70 949 3977</a></span>
            <b>Email</b><span><a href="mailto:nutu.fighter@gmail.com">nutu.fighter@gmail.com</a></span>
          </div>
        </div>
        <div class="hr"></div>
        <div>
          <div style="font-weight:700;margin-bottom:8px">Heti ütemterv</div>
          <ul style="margin:0;padding-left:18px;color:var(--muted)">
            <li>Hétfő – Szerda – Péntek: 16:00 Kezdő csoport, 17:00 Utánpótlás, 18:00 Versenyzők/Felnőttek</li>
            <li>Kedd – Csütörtök: 17:00 Kiscsoport (előre egyeztetve), 18:00 Női csoport</li>
          </ul>
        </div>
        <div class="hr"></div>
        <div>
          <div style="font-weight:700;margin-bottom:8px">Típusok</div>
          <div class="chips" id="typeChips"></div>
        </div>
      </div>
      <div style="height:12px"></div>
      <div class="card">
        <div style="font-weight:700;margin-bottom:8px">Hírek</div>
        <div class="news-list" id="newsList"></div>
      </div>
    </div>
  </aside>
</main>

<footer class="footer">
  <div class="container">
    <div style="display:flex;flex-wrap:wrap;gap:16px;justify-content:space-between;align-items:center">
      <div class="contact">
        <div>NUTU Team • Kickbox</div>
        <div>Jókai Mór utca 8., Mosonmagyaróvár, Hungary</div>
        <div><a href="tel:+36709493977">+36 70 949 3977</a> • <a href="mailto:nutu.fighter@gmail.com">nutu.fighter@gmail.com</a></div>
      </div>
      <div>&copy; <span id="year"></span> NUTU Team. Minden jog fenntartva.</div>
    </div>
  </div>
</footer>

<div class="modal" id="bookModal">
  <div class="sheet">
    <div class="hd">
      <div style="font-weight:800">Foglalás</div>
      <button class="button ghost" id="closeModal">Bezár</button>
    </div>
    <div class="bd">
      <div id="bookMeta" style="margin-bottom:8px;color:var(--muted)"></div>
      <div class="input">
        <label>Név</label>
        <input id="inpName" placeholder="Teljes név">
      </div>
      <div class="two">
        <div class="input">
          <label>Email</label>
          <input id="inpEmail" type="email" placeholder="email@cím.hu">
        </div>
        <div class="input">
          <label>Telefon</label>
          <input id="inpPhone" placeholder="+36 ...">
        </div>
      </div>
      <div class="input">
        <label>Megjegyzés</label>
        <textarea id="inpNote" placeholder="Kérdés, extra információ"></textarea>
      </div>
      <button class="button accent" id="confirmBooking">Foglalás megerősítése</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const JSONBIN_API_KEY = "$2a$10$9sO/ja29sMebpWNvsWmp5.dJ6lv7CPeLBMRFaA/cAEwz42ii6qlCS";
const BINS = {
  announcements: "68b5536243b1c97be932d1ed",
  reservations: "68b5535343b1c97be932d1e1",
  news: "68b5531fd0ea881f406dbd52",
  calendar: "68b55123d0ea881f406dbb52"
};
const state = {
  calendar: null,
  news: [],
  announcements: [],
  reservations: [],
  weekStart: startOfWeek(new Date()),
  selected: null
};

function startOfWeek(d){
  const nd = new Date(d); const day = (nd.getDay()+6)%7; nd.setDate(nd.getDate()-day); nd.setHours(0,0,0,0); return nd;
}
function fmtDate(d){return d.toLocaleDateString("hu-HU",{year:"numeric",month:"2-digit",day:"2-digit"})}
function fmtShort(d){return d.toLocaleDateString("hu-HU",{month:"2-digit",day:"2-digit"})}
function ymd(d){return d.toISOString().slice(0,10)}
function showToast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2600)}
async function fetchBin(id){
  const r = await fetch(`https://api.jsonbin.io/v3/b/${id}/latest`,{headers:{'X-Master-Key':JSONBIN_API_KEY}});
  if(!r.ok) throw new Error("Hálózati hiba");
  const j = await r.json(); return j.record;
}
async function putBin(id,record){
  const r = await fetch(`https://api.jsonbin.io/v3/b/${id}`,{method:"PUT",headers:{'Content-Type':'application/json','X-Master-Key':JSONBIN_API_KEY},body:JSON.stringify(record)});
  if(!r.ok) throw new Error("Mentési hiba");
  return (await r.json()).record;
}

async function loadAll(){
  try{
    const [calendar,news,anns,res] = await Promise.all([
      fetchBin(BINS.calendar),
      fetchBin(BINS.news),
      fetchBin(BINS.announcements),
      fetchBin(BINS.reservations),
    ]);
    state.calendar = calendar;
    state.news = news;
    state.announcements = anns.filter(a=>a.active!==false).filter(a=>!a.expiresAt||new Date(a.expiresAt)>=new Date());
    state.reservations = res;
    renderLegend();
    renderChips();
    renderAnnouncements();
    renderNews();
    renderCalendar();
  }catch(e){showToast("Hiba történt az adatok betöltése közben")}
}

function renderLegend(){
  const el = document.getElementById("legend");
  el.innerHTML = "";
  (state.calendar?.trainingTypes||[]).forEach(t=>{
    const node = document.createElement("div");
    node.className = "leg";
    node.innerHTML = `<div class="leg-dot" style="background:${t.color||'#6da9ff'}"></div><div>${t.name} • ${t.level}</div>`;
    el.appendChild(node);
  });
}

function renderChips(){
  const el = document.getElementById("typeChips");
  el.innerHTML = "";
  (state.calendar?.trainingTypes||[]).forEach(t=>{
    const d = document.createElement("div");
    d.className="chip";
    d.style.borderColor = t.color;
    d.innerHTML = `${t.name} • ${t.level} • ${t.location||'Helyben'} • Kapacitás: ${t.capacity??'—'} • ${t.duration||60} perc`;
    el.appendChild(d);
  });
}

function renderAnnouncements(){
  const bar = document.getElementById("announceStrip");
  bar.innerHTML = "";
  state.announcements.forEach(a=>{
    const b = document.createElement("div");
    const cls = a.type==="danger"?"danger":a.type==="success"?"success":"info";
    b.className = "badge "+cls;
    b.textContent = `${a.title} — ${a.content}`;
    bar.appendChild(b);
  });
}

function renderNews(){
  const list = document.getElementById("newsList");
  list.innerHTML = "";
  if(!state.news?.length){list.innerHTML='<div style="color:var(--muted)">Nincs hír</div>';return}
  state.news.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(n=>{
    const it = document.createElement("div");
    it.className="news-item";
    const img = n.image?`<img src="${n.image}" alt="hír">`:"";
    it.innerHTML = `${img}<div><div style="font-weight:700">${n.title}</div><div style="color:var(--muted);font-size:13px">${fmtDate(new Date(n.date))}</div><div style="margin-top:6px">${n.content}</div></div>`;
    list.appendChild(it);
  });
}

function weekDays(){
  const arr=[]; for(let i=0;i<7;i++){const d=new Date(state.weekStart); d.setDate(d.getDate()+i); arr.push(d)}; return arr;
}

function generateSlotsForDate(dateYMD){
  const day = new Date(dateYMD).getDay(); const weekday = (day+6)%7;
  const slots=[];
  for(const r of state.calendar.recurring||[]){
    if(r.weekday===weekday){
      const tt = (state.calendar.trainingTypes||[]).find(t=>t.id===r.trainingTypeId);
      if(!tt) continue;
      slots.push({
        trainingType: tt,
        time: r.time,
        date: dateYMD,
        capacity: r.capacity ?? tt.capacity ?? null,
        location: r.location ?? tt.location ?? "",
        duration: tt.duration ?? 60,
        recurringId: r.id
      });
    }
  }
  return slots;
}

function reservationsCount(dateYMD,time,trainingTypeId){
  return (state.reservations||[]).filter(r=>r.date===dateYMD && r.time===time && r.trainingTypeId===trainingTypeId).length;
}

function renderCalendar(){
  const grid = document.getElementById("calGrid");
  grid.innerHTML = "";
  const days = weekDays();
  const range = `${fmtShort(days[0])} – ${fmtShort(days[6])}`;
  document.getElementById("calRange").textContent = range;
  days.forEach(d=>{
    const wrap = document.createElement("div");
    wrap.className="day"+(ymd(d)===ymd(new Date())?" today":"");
    const head = document.createElement("div");
    head.className="dhead";
    head.innerHTML = `<div>${d.toLocaleDateString("hu-HU",{weekday:"long"})}</div><div>${fmtShort(d)}</div>`;
    wrap.appendChild(head);
    const slots = generateSlotsForDate(ymd(d));
    if(!slots.length){
      const x = document.createElement("div");
      x.style.color="var(--muted)"; x.style.fontSize="12px"; x.textContent = "Nincs edzés";
      wrap.appendChild(x);
    }else{
      slots.sort((a,b)=>a.time.localeCompare(b.time)).forEach(s=>{
        const taken = reservationsCount(s.date,s.time,s.trainingType.id);
        const full = s.capacity!=null && taken>=s.capacity;
        const slot = document.createElement("div");
        slot.className="slot"+(full?" full":"");
        slot.innerHTML = `
          <div class="dot" style="background:${s.trainingType.color}"></div>
          <div>
            <strong>${s.time} • ${s.trainingType.name}</strong>
            <div class="meta">${s.trainingType.level} • ${s.location} • ${s.duration} perc</div>
            <div class="meta">${s.capacity!=null?`Férőhely: ${taken}/${s.capacity}`:'Férőhely: korlátozás nélkül'}</div>
          </div>
          <button class="book"${full?' disabled':''}>${full?'Betelt':'Foglalok'}</button>
        `;
        slot.querySelector(".book")?.addEventListener("click",()=>openBooking(s));
        wrap.appendChild(slot);
      });
    }
    grid.appendChild(wrap);
  });
}

function openBooking(slot){
  state.selected = slot;
  document.getElementById("bookMeta").textContent = `${slot.date} • ${slot.time} • ${slot.trainingType.name} (${slot.trainingType.level})`;
  document.getElementById("bookModal").classList.add("active");
}
function closeBooking(){
  document.getElementById("bookModal").classList.remove("active");
  state.selected=null;
  ["inpName","inpEmail","inpPhone","inpNote"].forEach(id=>document.getElementById(id).value="");
}

async function submitBooking(){
  const name = document.getElementById("inpName").value.trim();
  const email = document.getElementById("inpEmail").value.trim();
  const phone = document.getElementById("inpPhone").value.trim();
  const note = document.getElementById("inpNote").value.trim();
  if(!state.selected){return}
  if(!name || !email){showToast("Kérlek töltsd ki a nevet és email címet");return}
  const existing = await fetchBin(BINS.reservations);
  const taken = existing.filter(r=>r.date===state.selected.date && r.time===state.selected.time && r.trainingTypeId===state.selected.trainingType.id).length;
  if(state.selected.capacity!=null && taken>=state.selected.capacity){showToast("Sajnos időközben betelt"); renderCalendar(); closeBooking(); return}
  const newRes = {
    id: crypto.randomUUID(),
    trainingTypeId: state.selected.trainingType.id,
    date: state.selected.date,
    time: state.selected.time,
    name,email,phone,note,
    createdAt: new Date().toISOString()
  };
  const merged = [...existing,newRes];
  await putBin(BINS.reservations,merged);
  state.reservations = merged;
  showToast("Foglalás sikeres! Találkozunk az edzésen.");
  closeBooking();
  renderCalendar();
}

document.getElementById("prevBtn").addEventListener("click",()=>{state.weekStart.setDate(state.weekStart.getDate()-7);renderCalendar()});
document.getElementById("nextBtn").addEventListener("click",()=>{state.weekStart.setDate(state.weekStart.getDate()+7);renderCalendar()});
document.getElementById("closeModal").addEventListener("click",closeBooking);
document.getElementById("confirmBooking").addEventListener("click",submitBooking);
document.getElementById("year").textContent = new Date().getFullYear();
loadAll();
</script>
</body>
</html>
