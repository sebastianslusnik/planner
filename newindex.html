<!doctype html>
<html lang="hu" data-bs-theme="dark">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NUTU Team – Foglalás és edzések</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
      :root {
        --bg: #0b0f14;
        --bg2: #121722;
        --card: #141a24;
        --muted: #9aa4b2;
        --accent: #e11d2e;
        --accent2: #3ee21d
      }

      html,
      body {
        background: linear-gradient(180deg, var(--bg) 0%, #0d1117 100%);
        color: #e9eef5;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif
      }

      .navbar {
        background: rgba(10, 13, 18, .8);
        backdrop-filter: saturate(140%) blur(8px)
      }

      .hero {
        position: relative;
        overflow: hidden;
        background: radial-gradient(1200px 600px at 80% -10%, rgba(225, 29, 46, .25), transparent), radial-gradient(1000px 500px at 0% -10%, rgba(62, 226, 29, .15), transparent)
      }

      .hero .badge {
        letter-spacing: .08em
      }

      .section {
        padding: 64px 0
      }

      .card {
        background: linear-gradient(180deg, var(--card), #0f141d);
        border: 1px solid rgba(255, 255, 255, .06)
      }

      .fc .fc-toolbar-title {
        font-weight: 800
      }

      .fc .fc-daygrid-event {
        border-radius: 8px;
        padding: 2px 6px
      }

      .btn-accent {
        background: var(--accent);
        border-color: var(--accent)
      }

      .btn-accent:hover {
        filter: brightness(1.1)
      }

      .tag {
        font-size: .75rem;
        border: 1px solid rgba(255, 255, 255, .08);
        border-radius: 999px;
        padding: .25rem .6rem;
        color: #c9d4e2
      }

      .announcement {
        border-left: 5px solid;
        border-radius: 8px
      }

      .announcement.danger {
        border-left-color: #dc3545;
        background: rgba(220, 53, 69, .08)
      }

      .announcement.info {
        border-left-color: #0dcaf0;
        background: rgba(13, 202, 240, .08)
      }

      .announcement.success {
        border-left-color: #198754;
        background: rgba(25, 135, 84, .08)
      }

      .announcement.warning {
        border-left-color: #ffc107;
        background: rgba(255, 193, 7, .08)
      }

      .kbd {
        border: 1px solid rgba(255, 255, 255, .12);
        border-bottom-width: 3px;
        border-radius: 6px;
        padding: .15rem .4rem;
        font-size: .8rem;
        background: #0c121a
      }

      .footer {
        border-top: 1px solid rgba(255, 255, 255, .06);
        background: #0a0e14
      }

      .badge-cap {
        background: rgba(255, 255, 255, .08);
        border: 1px solid rgba(255, 255, 255, .15)
      }

      .news-img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 10px
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
      <div class="container"> <a class="navbar-brand fw-bold" href="#">NUTU Team</a> <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#nav"><span class="navbar-toggler-icon"></span></button>
        <div id="nav" class="collapse navbar-collapse">
          <ul class="navbar-nav ms-auto gap-2">
            <li class="nav-item"><a class="nav-link" href="#foglalas">Foglalás</a></li>
            <li class="nav-item"><a class="nav-link" href="#edzesek">Edzések</a></li>
            <li class="nav-item"><a class="nav-link" href="#hirek">Hírek</a></li>
            <li class="nav-item"><a class="nav-link" href="#kapcsolat">Kapcsolat</a></li>
          </ul> <a href="admin.html" class="btn btn-outline-light ms-lg-3">Admin</a>
        </div>
      </div>
    </nav>
    <div id="announcementsBar" class="py-2" style="display:none;background:linear-gradient(90deg,rgba(225,29,46,.15),rgba(62,226,29,.08))">
      <div class="container" id="announcementsContainer"></div>
    </div>
    <header class="hero section">
      <div class="container">
        <div class="row align-items-center gy-4">
          <div class="col-lg-7"> <span class="badge text-bg-dark border">Kick-box • Egyéni és csoportos</span>
            <h1 class="display-5 fw-black mt-3">Farkas László NUTU</h1>
            <p class="lead text-secondary">Kickbox világbajnok és személyi edző. Modern edzések, valódi eredmények. Csatlakozz a NUTU Team-hez Mosonmagyaróváron.</p>
            <div class="d-flex gap-2"> <a href="#foglalas" class="btn btn-accent btn-lg">Időpontfoglalás</a> <a href="#edzesek" class="btn btn-outline-light btn-lg">Edzéstípusok</a> </div>
            <div class="d-flex mt-3 gap-3"> <span class="tag"><i class="bi bi-geo-alt"></i> Jókai Mór utca 8., Mosonmagyaróvár</span> <span class="tag"><i class="bi bi-clock-history"></i> Rendszeres órarend</span> </div>
          </div>
          <div class="col-lg-5">
            <div class="card p-4">
              <div class="d-flex align-items-center mb-3">
                <div class="flex-grow-1">
                  <div class="fw-bold">Elérhetőségek</div>
                  <div class="text-secondary">NUTU Team</div>
                </div>
              </div>
              <div class="d-grid gap-2"> <a class="btn btn-outline-light" href="tel:+36709493977"><i class="bi bi-telephone"></i> +36 70 949 3977</a> <a class="btn btn-outline-light" href="mailto:nutu.fighter@gmail.com"><i class="bi bi-envelope"></i> nutu.fighter@gmail.com</a> <a class="btn btn-outline-light" target="_blank" href="https://maps.google.com/?q=J%C3%B3kai+M%C3%B3r+utca+8.,+Mosonmagyar%C3%B3v%C3%A1r"><i class="bi bi-geo-alt"></i> Térkép megnyitása</a> </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <section id="edzesek" class="section">
      <div class="container">
        <div class="d-flex align-items-end justify-content-between mb-3">
          <h2 class="fw-bold m-0">Edzéstípusok</h2> <span class="text-secondary">Minden szerkeszthető az Admin felületen</span>
        </div>
        <div id="trainingTypesRow" class="row g-3"></div>
        <div class="card p-4 mt-4">
          <div class="d-flex align-items-center justify-content-between">
            <h3 class="m-0">Heti ütemterv</h3>
            <span class="text-secondary">Aktuális foglalhatóság a naptárban</span>
          </div>
          <div class="row g-4 mt-1">
            <div class="col-md-6">
              <div class="p-3 rounded" style="background:#0d131c">
                <div class="fw-bold mb-2">Hétfő • Szerda • Péntek</div>
                <div>16:00 Kezdő csoportos edzések</div>
                <div>17:00 Utánpótlás csoportos edzések</div>
                <div>18:00 Versenyzői/Felnőtt csoportos edzések</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-3 rounded" style="background:#0d131c">
                <div class="fw-bold mb-2">Kedd • Csütörtök</div>
                <div>17:00 Kiscsoportos edzések (előre egyeztetve)</div>
                <div>18:00 Női csoportos edzések</div>
              </div>
            </div>
          </div>
          <div class="text-secondary mt-2">Az Admin felületen a visszatérő időpontok és kapacitások testreszabhatók.</div>
        </div>
      </div>
    </section>
    <section id="foglalas" class="section">
      <div class="container">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="fw-bold m-0">Naptár és foglalás</h2>
          <div class="d-flex align-items-center gap-2 text-secondary"> <span class="badge badge-cap"><i class="bi bi-people"></i> Kapacitás követés</span> <span class="badge badge-cap"><i class="bi bi-shield-lock"></i> JSONBin szinkron</span> </div>
        </div>
        <div class="row g-4">
          <div class="col-lg-8">
            <div id="calendar" class="card p-3"></div>
          </div>
          <div class="col-lg-4">
            <div class="card p-4">
              <div class="fw-bold mb-2">Következő időpontok</div>
              <div id="upcomingList" class="d-grid gap-2"></div>
              <hr>
              <div class="text-secondary">Tippek</div>
              <div class="small mt-1"><span class="kbd">D</span> napi nézet • <span class="kbd">W</span> heti nézet • <span class="kbd">M</span> havi nézet</div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="hirek" class="section">
      <div class="container">
        <div class="d-flex align-items-end justify-content-between mb-3">
          <h2 class="fw-bold m-0">Hírek</h2> <a href="admin.html#tab-news" class="btn btn-outline-light">Hírek kezelése</a>
        </div>
        <div id="newsRow" class="row g-3"></div>
      </div>
    </section>
    <section id="kapcsolat" class="section">
      <div class="container">
        <div class="row g-4">
          <div class="col-lg-5">
            <h2 class="fw-bold">Kapcsolat</h2>
            <div class="mt-3">NUTU Team</div>
            <div>Jókai Mór utca 8., Mosonmagyaróvár, Hungary</div>
            <div class="mt-2"><a class="link-light" href="tel:+36709493977">+36 70 949 3977</a></div>
            <div><a class="link-light" href="mailto:nutu.fighter@gmail.com">nutu.fighter@gmail.com</a></div>
            <div class="mt-3"><a class="btn btn-outline-light" target="_blank" href="https://maps.google.com/?q=J%C3%B3kai+M%C3%B3r+utca+8.,+Mosonmagyar%C3%B3v%C3%A1r"><i class="bi bi-geo-alt"></i> Útvonal</a></div>
          </div>
          <div class="col-lg-7">
            <div class="ratio ratio-16x9 card overflow-hidden"> <iframe src="https://www.google.com/maps?&q=J%C3%B3kai%20M%C3%B3r%20utca%208%2C%20Mosonmagyar%C3%B3v%C3%A1r&output=embed" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" style="border:0"></iframe> </div>
          </div>
        </div>
      </div>
    </section>
    <footer class="footer py-4">
      <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
        <div class="text-secondary">© <span id="year"></span> NUTU Team</div>
        <div class="small text-secondary">Farkas László NUTU • Kickbox világbajnok és személyi edző</div>
      </div>
    </footer>
    <div class="modal fade" id="bookingModal" tabindex="-1">
      <div class="modal-dialog">
        <form id="bookingForm" class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Időpont foglalása</h5> <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="bookingSlot" class="mb-3"></div>
            <div class="row g-2">
              <div class="col-sm-6"> <label class="form-label">Név</label> <input type="text" id="bk_name" class="form-control" required> </div>
              <div class="col-sm-6"> <label class="form-label">E-mail</label> <input type="email" id="bk_email" class="form-control" required> </div>
              <div class="col-sm-6"> <label class="form-label">Telefon</label> <input type="tel" id="bk_phone" class="form-control"> </div>
              <div class="col-sm-6"> <label class="form-label">Megjegyzés</label> <input type="text" id="bk_note" class="form-control"> </div>
            </div>
            <div id="bookingWarning" class="alert alert-danger mt-3 d-none"></div>
          </div>
          <div class="modal-footer"> <button class="btn btn-outline-light" data-bs-dismiss="modal" type="button">Mégse</button> <button class="btn btn-accent" type="submit">Foglalás</button> </div>
        </form>
      </div>
    </div>
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index:1080">
      <div id="toast" class="toast align-items-center text-bg-dark border-0" role="alert">
        <div class="d-flex">
          <div class="toast-body" id="toastBody">Művelet kész</div> <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js"></script>
    <script>
      const BINS = {
        announcements: "68b5536243b1c97be932d1ed",
        reservations: "68b5535343b1c97be932d1e1",
        news: "68b5531fd0ea881f406dbd52",
        calendar: "68b55123d0ea881f406dbb52"
      };
      let MASTER_KEY = "$2a$10$9sO/ja29sMebpWNvsWmp5.dJ6lv7CPeLBMRFaA/cAEwz42ii6qlCS";
      const state = {
        calendar: null,
        trainingTypes: [],
        recurring: [],
        news: [],
        announcements: [],
        reservations: [],
        site: null
      };
      const ui = {
        calendar: null,
        bookingModal: null,
        toast: null
      };
      document.getElementById("year").textContent = new Date().getFullYear();

      function setToast(msg) {
        document.getElementById("toastBody").textContent = msg;
        new bootstrap.Toast(document.getElementById("toast")).show()
      }

      function uuid() {
        if ("randomUUID" in crypto) {
          return crypto.randomUUID()
        }
        const a = () => Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
        return a() + a() + "-" + a() + "-" + a() + "-" + a() + "-" + a() + a() + a()
      }

      function todayStr() {
        const d = new Date();
        return d.toISOString().slice(0, 10)
      }

      function toLocalDateStr(d) {
        const dt = new Date(d);
        return dt.toLocaleDateString("hu-HU", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit"
        })
      }

      function pad(n) {
        return n.toString().padStart(2, "0")
      }

      function fetchBin(binId) {
        return fetch("https://api.jsonbin.io/v3/b/" + binId + "/latest").then(r => r.json()).then(j => j.record || j)
      }

      function putBin(binId, data) {
        const key = localStorage.getItem("jsonbin_master_key") || MASTER_KEY;
        return fetch("https://api.jsonbin.io/v3/b/" + binId, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": key
          },
          body: JSON.stringify(data)
        }).then(r => {
          if (!r.ok) throw new Error("Hiba: " + r.status);
          return r.json()
        })
      }

      function clamp(n, min, max) {
        return Math.max(min, Math.min(n, max))
      }

      function hexToRgba(hex, alpha) {
        const c = (hex || "#e11d2e").replace("#", "");
        const bigint = parseInt(c, 16);
        const r = (bigint >> 16) & 255;
        const g = (bigint >> 8) & 255;
        const b = bigint & 255;
        return "rgba(" + r + "," + g + "," + b + "," + alpha + ")"
      }

      function eventKey(ttId, date, time) {
        return ttId + "|" + date + "|" + time
      }

      function computeCapacityMap() {
        const m = new Map();
        for (const r of state.reservations) {
          const k = eventKey(r.trainingTypeId, r.date, r.time);
          m.set(k, (m.get(k) || 0) + 1)
        }
        return m
      }

      function buildEvents(rangeStart, rangeEnd) {
        const capacityMap = computeCapacityMap();
        const events = [];
        const start = new Date(rangeStart);
        const end = new Date(rangeEnd);
        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
          const wd = (d.getDay() + 6) % 7;
          for (const rec of state.recurring) {
            if (rec.weekday === wd) {
              const tt = state.trainingTypes.find(t => t.id === rec.trainingTypeId);
              if (!tt) continue;
              const dateStr = d.toISOString().slice(0, 10);
              const time = rec.time;
              const cap = rec.capacity ?? tt.capacity ?? null;
              const reserved = capacityMap.get(eventKey(tt.id, dateStr, time)) || 0;
              const left = cap == null ? null : clamp(cap - reserved, 0, 999);
              events.push({
                id: uuid(),
                title: tt.name + " • " + (tt.level || ""),
                start: dateStr + "T" + time,
                allDay: false,
                backgroundColor: tt.color,
                borderColor: tt.color,
                display: "block",
                extendedProps: {
                  trainingTypeId: tt.id,
                  date: dateStr,
                  time: time,
                  location: rec.location || tt.location || "",
                  capacity: cap,
                  reserved: reserved,
                  left: left,
                  tt
                }
              })
            }
          }
          return events
        }

        function renderAnnouncements() {
          const cont = document.getElementById("announcementsContainer");
          cont.innerHTML = "";
          const now = todayStr();
          const items = state.announcements.filter(a => a.active !== false).filter(a => !a.expiresAt || a.expiresAt >= now);
          if (!items.length) {
            document.getElementById("announcementsBar").style.display = "none";
            return
          }
          document.getElementById("announcementsBar").style.display = "block";
          for (const a of items) {
            const div = document.createElement("div");
            div.className = "announcement " + (a.type || "info") + " p-3 mb-2";
            div.innerHTML = "<div class='d-flex align-items-center justify-content-between'><div><div class='fw-bold'>" + a.title + "</div><div class='text-secondary'>" + (a.content || "") + "</div></div><div class='small text-secondary'>" + (a.expiresAt ? ("Lejár: " + toLocalDateStr(a.expiresAt)) : "") + "</div></div>";
            cont.appendChild(div)
          }
        }

        function renderTrainingTypes() {
          const row = document.getElementById("trainingTypesRow");
          row.innerHTML = "";
          for (const t of state.trainingTypes) {
            const col = document.createElement("div");
            col.className = "col-md-6 col-lg-4";
            const cap = t.capacity != null ? ("<span class='badge badge-cap ms-2'><i class='bi bi-people'></i> " + t.capacity + "</span>") : "";
            col.innerHTML = "<div class='card h-100 p-4'><div class='d-flex align-items-center justify-content-between'><div class='fw-bold'>" + t.name + "</div><div class='badge' style='background:" + hexToRgba(t.color || "#e11d2e", .18) + ";color:#fff;border:1px solid " + hexToRgba(t.color || "#e11d2e", .4) + "'>" + (t.level || "") + "</div></div><div class='text-secondary mt-2'>" + (t.description || "") + "</div><div class='mt-3 small text-secondary'><i class='bi bi-geo-alt'></i> " + (t.location || "") + "</div><div class='mt-2 small text-secondary'><i class='bi bi-hourglass'></i> " + (t.duration || 60) + " perc " + cap + "</div></div>";
            row.appendChild(col)
          }
        }

        function formatTime(t) {
          return t.slice(0, 5)
        }

        function renderUpcoming() {
          const list = document.getElementById("upcomingList");
          list.innerHTML = "";
          const now = new Date();
          const events = ui.calendar.getEvents().filter(e => e.start >= now).sort((a, b) => a.start - b.start).slice(0, 6);
          for (const e of events) {
            const left = e.extendedProps.left;
            const disabled = left === 0;
            const btn = document.createElement("button");
            btn.className = "btn btn-outline-light d-flex align-items-center justify-content-between";
            btn.disabled = disabled;
            btn.innerHTML = "<div class='text-start'><div class='fw-bold'>" + e.title + "</div><div class='small text-secondary'>" + e.start.toLocaleString("hu-HU", {
              weekday: "short",
              month: "2-digit",
              day: "2-digit"
            }) + " • " + formatTime(e.extendedProps.time) + " • " + (e.extendedProps.location || "") + "</div></div><span class='badge " + (disabled ? "text-bg-danger" : "text-bg-success") + "'>" + (left == null ? "∞" : left) + "</span>";
            btn.onclick = () => openBooking(e);
            list.appendChild(btn)
          }
        }

        function openBooking(event) {
          const left = event.extendedProps.left;
          const warning = document.getElementById("bookingWarning");
          warning.classList.add("d-none");
          if (left === 0) {
            warning.textContent = "Erre az időpontra betelt a férőhely. Válassz másikat.";
            warning.classList.remove("d-none")
          }
          document.getElementById("bookingSlot").innerHTML = "<div class='d-flex align-items-center justify-content-between'><div><div class='fw-bold'>" + event.title + "</div><div class='text-secondary small'>" + event.start.toLocaleDateString("hu-HU", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit"
          }) + " • " + formatTime(event.extendedProps.time) + " • " + (event.extendedProps.location || "") + "</div></div><div class='badge " + (left === 0 ? "text-bg-danger" : "text-bg-success") + "'>" + (left == null ? "∞ férőhely" : left + " férőhely") + "</div></div>";
          document.getElementById("bookingForm").dataset.trainingTypeId = event.extendedProps.trainingTypeId;
          document.getElementById("bookingForm").dataset.date = event.extendedProps.date;
          document.getElementById("bookingForm").dataset.time = event.extendedProps.time;
          ui.bookingModal.show()
        }

        function initCalendar() {
          const el = document.getElementById("calendar");
          ui.calendar = new FullCalendar.Calendar(el, {
            initialView: "dayGridMonth",
            height: "auto",
            headerToolbar: {
              left: "prev,next today",
              center: "title",
              right: "dayGridMonth,timeGridWeek,timeGridDay"
            },
            eventClick: info => openBooking(info.event),
            events: (info, success) => {
              const ev = buildEvents(info.start, info.end);
              success(ev)
            }
          });
          ui.calendar.render();
          renderUpcoming()
        }

        function refreshCalendar() {
          if (ui.calendar) {
            ui.calendar.refetchEvents();
            setTimeout(renderUpcoming, 200)
          }
        }

        function loadAll() {
          return Promise.all([fetchBin(BINS.calendar).then(d => {
            state.trainingTypes = d.trainingTypes || [];
            state.recurring = d.recurring || [];
            state.site = d.site || null
          }), fetchBin(BINS.reservations).then(d => {
            state.reservations = Array.isArray(d) ? d : (d || [])
          }).catch(() => {
            state.reservations = []
          }), fetchBin(BINS.news).then(d => {
            state.news = Array.isArray(d) ? d : (d?.items || [])
          }).catch(() => {
            state.news = []
          }), fetchBin(BINS.announcements).then(d => {
            state.announcements = Array.isArray(d) ? d : (d?.items || [])
          }).catch(() => {
            state.announcements = []
          })])
        }

        function renderNews() {
          const row = document.getElementById("newsRow");
          row.innerHTML = "";
          const items = [...state.news].sort((a, b) => new Date(b.date) - new Date(a.date));
          if (items.length === 0) {
            const col = document.createElement("div");
            col.className = "col-12";
            col.innerHTML = "<div class='card p-4 text-secondary'>Még nincsenek hírek.</div>";
            row.appendChild(col);
            return
          }
          for (const n of items) {
            const col = document.createElement("div");
            col.className = "col-md-6 col-lg-4";
            const img = n.image ? ("<img class='news-img' src='" + n.image + "' alt=''>") : "<div class='news-img d-flex align-items-center justify-content-center' style='background:#0d131c'><i class='bi bi-megaphone fs-1 text-secondary'></i></div>";
            col.innerHTML = "<div class='card p-3 h-100'>" + img + "<div class='mt-3'><div class='small text-secondary'>" + toLocalDateStr(n.date) + "</div><div class='fw-bold mt-1'>" + n.title + "</div><div class='text-secondary mt-1'>" + (n.content || "") + "</div></div></div>";
            row.appendChild(col)
          }
        }

        function bindHotkeys() {
          document.addEventListener("keydown", e => {
            if (e.key === "w" || e.key === "W") {
              ui.calendar.changeView("timeGridWeek")
            }
            if (e.key === "d" || e.key === "D") {
              ui.calendar.changeView("timeGridDay")
            }
            if (e.key === "m" || e.key === "M") {
              ui.calendar.changeView("dayGridMonth")
            }
          })
        }
        document.getElementById("bookingForm").addEventListener("submit", async e => {
          e.preventDefault();
          const name = document.getElementById("bk_name").value.trim();
          const email = document.getElementById("bk_email").value.trim();
          const phone = document.getElementById("bk_phone").value.trim();
          const note = document.getElementById("bk_note").value.trim();
          const f = e.currentTarget;
          const trainingTypeId = f.dataset.trainingTypeId;
          const date = f.dataset.date;
          const time = f.dataset.time;
          const newRes = {
            id: uuid(),
            trainingTypeId,
            date,
            time,
            name,
            email,
            phone,
            note,
            createdAt: new Date().toISOString()
          };
          try {
            const arr = Array.isArray(state.reservations) ? [...state.reservations] : [];
            arr.push(newRes);
            await putBin(BINS.reservations, arr);
            state.reservations = arr;
            ui.bookingModal.hide();
            setToast("Foglalás rögzítve");
            refreshCalendar()
          } catch (err) {
            setToast("Nem sikerült menteni. Ellenőrizd a kapcsolatot vagy a kulcsot.")
          }
        })
        window.addEventListener("load", async () => {
          const stored = localStorage.getItem("jsonbin_master_key");
          if (stored) MASTER_KEY = stored;
          ui.bookingModal = new bootstrap.Modal(document.getElementById("bookingModal"));
          ui.toast = new bootstrap.Toast(document.getElementById("toast"));
          await loadAll();
          renderAnnouncements();
          renderTrainingTypes();
          renderNews();
          initCalendar();
          bindHotkeys();
          setInterval(async () => {
            try {
              await loadAll();
              renderAnnouncements();
              renderTrainingTypes();
              renderNews();
              refreshCalendar()
            } catch (e) {}
          }, 60000)
        })
    </script>
  </body>

</html>
